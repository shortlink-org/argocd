include:
  - component: $CI_SERVER_FQDN/shortlink-org/gitlab-templates/crd@main

# CRD templates for ArgoCD
prometheus-operator:crd:
  extends:
    - .crd_templates
    - .matrix_deploy_provider
  stage: deploy
  variables:
    KUBE_CONTEXT: shortlink-org/argocd:${PROVIDER}
  parallel:
    matrix:
      - NAME: https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.83.0/example/prometheus-operator-crd/monitoring.coreos.com_alertmanagerconfigs.yaml
        APPLYSET: alertmanagerconfigs
      - NAME: https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.83.0/example/prometheus-operator-crd/monitoring.coreos.com_alertmanagers.yaml
        APPLYSET: alertmanagers
      - NAME: https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.83.0/example/prometheus-operator-crd/monitoring.coreos.com_podmonitors.yaml
        APPLYSET: podmonitors
      - NAME: https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.83.0/example/prometheus-operator-crd/monitoring.coreos.com_probes.yaml
        APPLYSET: probes
      - NAME: https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.83.0/example/prometheus-operator-crd/monitoring.coreos.com_prometheusagents.yaml
        APPLYSET: prometheusagents
      - NAME: https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.83.0/example/prometheus-operator-crd/monitoring.coreos.com_prometheuses.yaml
        APPLYSET: prometheuses
      - NAME: https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.83.0/example/prometheus-operator-crd/monitoring.coreos.com_prometheusrules.yaml
        APPLYSET: prometheusrules
      - NAME: https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.83.0/example/prometheus-operator-crd/monitoring.coreos.com_scrapeconfigs.yaml
        APPLYSET: scrapeconfigs
      - NAME: https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.83.0/example/prometheus-operator-crd/monitoring.coreos.com_servicemonitors.yaml
        APPLYSET: servicemonitors
      - NAME: https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.83.0/example/prometheus-operator-crd/monitoring.coreos.com_thanosrulers.yaml
        APPLYSET: thanosrulers
  retry: 1
  rules:
    - when: manual
  environment:
    name: ${PROVIDER}/prometheus-operator-crd
    deployment_tier: production
    kubernetes:
      namespace: default

# CRD templates for ArgoCD
istio:crd:
  extends:
    - .crd_templates
    - .matrix_deploy_provider
  stage: deploy
  variables:
    NAME: https://raw.githubusercontent.com/istio/istio/master/manifests/charts/base/crds/crd-all.gen.yaml
    APPLYSET: istio
  rules:
    - when: manual
  environment:
    name: ${PROVIDER}/istio-crd
    deployment_tier: production
    kubernetes:
      namespace: default
