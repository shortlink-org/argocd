################################################################################
# PROMETHEUS-OPERATOR · fan-out one child pipeline per CRD
################################################################################
prometheus:pipeline:
  extends: .matrix_deploy_provider

  trigger:
    include:
      - local: .gitlab/ci/pipeline/prometheus.yml

  needs: [ ]
  rules:
    - when: manual


################################################################################
# ISTIO · one child pipeline for the bundle
################################################################################
istio:crd:
  extends: .matrix_deploy_provider
  stage: deploy

  trigger:
    include:
      - component: $CI_SERVER_FQDN/shortlink-org/gitlab-templates/crd@main
        inputs:
          kube_context: shortlink-org/argocd:${PROVIDER}
          applyset:     istio
          manifest:     https://raw.githubusercontent.com/istio/istio/refs/heads/master/manifests/charts/base/files/crd-all.gen.yaml
    strategy: depend

  needs: [ ]
  rules:
    - when: manual
